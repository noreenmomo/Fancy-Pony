<!doctype html>
<meta charset="utf-8">
<title>Fancy Pony — Base64 Test</title>
<h2>Fancy Pony — Base64 Upload Test</h2>

<form id="f">
  <div><label>Name <input name="name" id="name" required></label></div>
  <div><label>Email <input name="email" id="email" type="email" required></label></div>
  <div><label>Pony Name <input name="title" id="title" required></label></div>
  <div><label>Consent <input type="checkbox" id="consent" checked></label></div>
  <div><label>File <input type="file" id="file" accept=".jpg,.jpeg,.png,.pdf" required></label></div>
  <button>Upload (base64 only)</button>
</form>

<pre id="out" style="background:#111;color:#0f0;padding:10px;white-space:pre-wrap"></pre>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyS8EeAEoACk6HqauFS1y44kI7j20xmuTmIJPucYmtnCBBBSiQu_uSZ8vJGftIaHueFvA/exec'; // <-- replace with your /exec

const out = document.getElementById('out');
function log(x){ out.textContent += (typeof x==='string'? x : JSON.stringify(x,null,2)) + '\n'; }

document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  out.textContent = '';

  const fileEl = document.getElementById('file');
  const file = fileEl.files[0];
  if (!file) return log('Pick a file.');

  // Convert to base64 (no multipart at all)
  const b64 = await new Promise((res, rej)=>{
    const fr = new FileReader();
    fr.onload = () => {
      const s = String(fr.result||'');
      const i = s.indexOf('base64,');
      res(i>=0 ? s.slice(i+7) : s);
    };
    fr.onerror = () => rej(fr.error || new Error('read error'));
    fr.readAsDataURL(file);
  });

  const fd = new FormData();
  fd.append('name',   document.getElementById('name').value.trim());
  fd.append('email',  document.getElementById('email').value.trim());
  fd.append('title',  document.getElementById('title').value.trim());
  fd.append('consent', document.getElementById('consent').checked ? 'true' : 'false');
  // base64 trio (what your backend already supports)
  fd.append('filebase64', b64);
  fd.append('mimetype', file.type || 'application/octet-stream');
  fd.append('filename', file.name || 'upload.bin');

  // Debug: show what keys we’re actually sending
  const keys = [];
  for (const [k] of fd.entries()) keys.push(k);
  log('Sending fields: ' + keys.join(', '));

  try{
    const r = await fetch(SCRIPT_URL, { method:'POST', body: fd });
    const txt = await r.text();
    log('Raw response:');
    log(txt);
    let data; try { data = JSON.parse(txt); } catch {}
    if (data && data.ok){
      log('✅ Upload OK');
      log(data);
    } else {
      log('❌ Upload failed');
      if (data) log(data);
    }
  }catch(err){
    log('Network error: ' + err.message);
  }
});
</script>
