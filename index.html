<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fancy Pony – Art Submission</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; background: #fafafa; }
  h1 { color: #333; }
  form { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  label { display: block; margin-top: 0.5rem; }
  input, textarea { width: 100%; padding: 0.5rem; margin-top: 0.2rem; border: 1px solid #ccc; border-radius: 4px; }
  button { margin-top: 1rem; padding: 0.6rem 1rem; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { background: #45a049; }
  #status { margin-top: 1rem; }
  .success { padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; display:inline-block; margin-bottom:6px; background:#f0fff0; }
</style>
</head>
<body>

<!-- ===================== HEADER ===================== -->
<h1>Fancy Pony – Art Submission</h1>
<p>Please fill in the form below to submit your artwork. If you provide your email, we will send a confirmation message.</p>

<!-- ===================== SUBMISSION FORM ===================== -->
<form id="uploadForm">
  <label for="name">Your Name:</label>
  <input type="text" id="name" name="name" required>

  <label for="class">Class:</label>
  <input type="text" id="class" name="class" required>

  <label for="title">Artwork Title:</label>
  <input type="text" id="title" name="title">

  <label for="description">Description:</label>
  <textarea id="description" name="description"></textarea>

  <label for="email">Email (for confirmation):</label>
  <input type="email" id="email" name="email">

  <label for="file">Choose File (JPG / PNG / PDF) – Please scan at 150–300 ppi:</label>
  <input type="file" id="file" name="file" accept=".jpg,.jpeg,.png,.pdf" required>

  <label>
    <input type="checkbox" id="consent" name="consent" value="true" required>
    I confirm that I have the rights to submit this work.
  </label>

  <button type="submit">Submit</button>
</form>

<!-- ===================== STATUS + COUNT ===================== -->
<div id="status"></div>
<div id="countContainer">
  <strong>Total submissions:</strong> <span id="count">Loading...</span>
  <button id="refreshBtn" type="button">Refresh total</button>
</div>

<!-- ===================== SCRIPT ===================== -->
<script>
  // ===== CONFIG =====
  const SCRIPT_URL = 'YOUR_DEPLOYED_WEB_APP_URL'; // Do NOT display this in the page.

  function $(id){ return document.getElementById(id); }

  async function refreshCount(){
    try {
      const res = await fetch(`${SCRIPT_URL}?action=count`);
      const data = await res.json();
      if (data.ok) $('count').textContent = data.count;
      else $('count').textContent = 'Error';
    } catch (err) {
      $('count').textContent = 'Error';
    }
  }

  $('refreshBtn').addEventListener('click', refreshCount);

  document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const status = $('status');
    status.textContent = 'Uploading...';

    const formData = new FormData(e.target);
    try {
      const res = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
      const data = await res.json();

      if (data.ok){
        const userEmail = $('email').value.trim();
        const line =
          userEmail
            ? 'You have successfully uploaded. A confirmation email has been sent.'
            : 'You have successfully uploaded.';
        status.innerHTML =
          `<div class="success">${line}</div>
           <div>File link: <a target="_blank" rel="noopener" href="${data.fileUrl}">Open</a></div>`;
        e.target.reset();
        await refreshCount();
      } else {
        status.textContent = 'Upload failed: ' + (data.error || 'Unknown error');
      }
    } catch (err) {
      status.textContent = 'Error: ' + err.message;
    }
  });

  // Load count on page load
  refreshCount();
</script>

</body>
</html>
