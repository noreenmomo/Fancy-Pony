<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Fancy Pony — Minimal Upload</title>
<style>
  body { font-family: system-ui, Arial; margin: 24px;}
  .ok { color:#0a7; } .err { color:#c00; white-space:pre-wrap;}
</style>

<h1>Fancy Pony – Minimal Upload</h1>

<form id="f" novalidate>
  <label>Your Name<br>
    <input id="name" name="name" required>
  </label><br><br>

  <label>Choose File (JPG/PNG/PDF)<br>
    <input id="file" name="file" type="file" accept=".jpg,.jpeg,.png,.pdf" required>
  </label><br><br>

  <button>Upload</button>
</form>

<div id="out"></div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyS8EeAEoACk6HqauFS1y44kI7j20xmuTmIJPucYmtnCBBBSiQu_uSZ8vJGftIaHueFvA/exec';
const $ = (s)=>document.querySelector(s);
$('#f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const out = $('#out');
  out.textContent = 'Uploading…';

  const file = $('#file').files[0];
  if (!file) { out.textContent = 'Please choose a file.'; return; }

  const fd = new FormData();
  fd.append('name', $('#name').value.trim());
  // 關鍵：名稱必須是 "file"，而且真的把檔案放進去
  fd.append('file', file, file.name);

  try {
    // 不要手動設定任何 headers！
    const r = await fetch(SCRIPT_URL, { method:'POST', body: fd });
    const txt = await r.text();
    console.log('raw:', txt);
    const j = JSON.parse(txt);
    console.log('server response:', j);

    if (j.ok) {
      out.innerHTML = `<div class="ok">OK. fileId=${j.fileId || '(?)'}<br>
        <a target="_blank" href="${j.fileUrl}">Open file</a></div>`;
    } else {
      out.innerHTML = `<div class="err">Failed: ${j.error || 'unknown'}\n${j.diag ? JSON.stringify(j.diag,null,2):''}</div>`;
    }
  } catch (err) {
    out.innerHTML = `<div class="err">Fetch error: ${err.message}</div>`;
  }
});
</script>
</html>
